
<head>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
	<style>
	.rect0 {
		fill: white;
		stroke: black;
		stroke-width: 1px;
	}

	.rect1 {
		fill: black;
		stroke: black;
		stroke-width:1px;
	}
	</style>
</head>
<body>
	<div id="root"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.18.1/babel.min.js"></script>
	<script type="text/babel">

	var Pixels = React.createClass({
		render: function() {
			var dots = this.props.row.map( function(j,index) {
				return (
					<rect x={index*10} width="10" height="10" className={"rect"+j} />
				);
			})
		return (
			<g transform={"translate(0," + this.props.rowIndex*10 + ")"}>
				{dots}
			</g>
			)
		}
	})

	var Grid = React.createClass({
		render: function() {
			var rows = this.props.data.map( function(i, index) {
					return(
							<Pixels row={i} rowIndex={index} />
						)
				});
		return (
			<svg width="500" height="500" viewBox="0 0 500 500">
				{rows}
			</svg>
		)
	}
	})


	var App = React.createClass({
		getInitialState() {
			return {
				grid: [],
				gridWidth: 50,
				gridHeight: 50
			};
		},
		componentWillMount() {
			this.generateGrid();
		},
		generateGrid() {
			var randomGrid = [];
			for(var h=0; h<this.state.gridHeight; h++){
				var row = [];
				for(var w = 0; w<this.state.gridWidth; w++){
					row.push(Math.floor(Math.random()*2));
				}
				randomGrid.push(row);
			}
			this.setState({grid: randomGrid})
		},
		changeGridHeight(event) {
			this.setState({gridHeight: event.target.value});
			this.generateGrid();
		},
		changeGridWidth(event) {
			this.setState({gridWidth: event.target.value});
			this.generateGrid();
		},
		gameOfLife() {
		var startThisShit = setInterval( () => {
		  var oldGrid = this.state.grid;
		  var newGrid = [];
		  // Iterating through grid
		  for(var i=0; i<this.state.gridHeight; i++) {
		    var row = [];
		    for(var j=0; j<this.state.gridWidth; j++) {
		      var iRows = [i-1, i, i+1];
		      var jCols = [j-1, j, j+1];
		      var sum = 0;
		      // Iterating through surrounding pixels/neighbours
		      for(var r=0; r<iRows.length; r++) {
		        for(var c=0; c<jCols.length; c++) {
		          if(iRows[r] < 0 || jCols[c] < 0 || iRows[r] >= this.state.gridHeight || jCols[c] >= this.state.gridWidth) {
		            continue;
		          } else {
		          sum += oldGrid[iRows[r]][jCols[c]];
		          }
		        }
		      }
		      // If the pixel being investigated is live, subtract 1
		      if(oldGrid[i][j]===1) {
		        sum -= 1
		      }
		      if(oldGrid[i][j]===0){
		        // Any dead cell with exactly 3 live neighbours becomes a live cell
		        if(sum==3){
		          row.push(1);
		        } else {
		          row.push(0);
		        }
		      // Live cells
		      } else {
		        // Any live cell with fewer than two live neighbours dies
		        // Any live cell with more than 3 live neighbours dies
		        if(sum < 2 || sum > 3) {
		          row.push(0);
		        // Any live cell with 2 or 3 live neighbours lives
		        } else if (sum === 2 || sum === 3) {
		          row.push(1);
		        }
		      }
		    }
		    newGrid.push(row)
		  }
			this.setState({grid:newGrid, intervalId: startThisShit})
		}, 100 )},
		stopThisShit() {
			clearInterval(this.state.intervalId)
		},
		render: function() {
			return(
				<div>
					<div className="row">
						<label># Rows:</label> <input type="number" defaultValue={this.state.gridHeight} onChange={this.changeGridHeight} />
						<label># Columns:</label> <input type="number" defaultValue={this.state.gridWidth} onChange={this.changeGridWidth} />
						<button onClick={this.generateGrid}>Gimme Another Grid!</button>
						<button onClick={this.gameOfLife}>Start!</button>
						<button onClick={this.stopThisShit}>Stop! </button>
					</div>
					<Grid data={this.state.grid} />
				</div>
			)
		}
	})

	ReactDOM.render(
		<App />,
		document.getElementById('root')
	)

	</script>
</body>
