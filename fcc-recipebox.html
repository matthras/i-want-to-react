<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css"></link>
</head>
<body>
	<div id="root"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.js"></script>
	<script>
	var Alert = ReactBootstrap.Alert;
	var Row = ReactBootstrap.Row;
	var Grid = ReactBootstrap.Grid;
	var Col = ReactBootstrap.Col;
	var Button = ReactBootstrap.Button;
	var Accordion = ReactBootstrap.Accordion;
	var Panel = ReactBootstrap.Panel;
	var ListGroup = ReactBootstrap.ListGroup;
	var ListGroupItem = ReactBootstrap.ListGroupItem;
	var PanelGroup = ReactBootstrap.PanelGroup;
	var Modal = ReactBootstrap.Modal;
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.18.1/babel.min.js"></script>
	<script type="text/babel">
	class RecipeBox extends React.Component {
		constructor(props) {
			super(props);
			this.state = {data: [{
					id: 1,
					name: 'Pumpkin Pie',
					ingredients: 'pumpkin puree, sweetened condensed milk, eggs, pumpkin pie spice, pie crust'
				},
				{
					id: 2,
					name: 'Spaghetti',
					ingredients: 'spaghetti noodles, tomato sauce, meatballs'
				}]
			}
			this.addRecipe = this.addRecipe.bind(this);
			this.deleteRecipe = this.deleteRecipe.bind(this);
		}
		// Delete a recipe
		deleteRecipe(item) {
			var items = this.state.data.filter(function(itm){
				return item.id !== itm.id;
			});
			this.setState({data: items})
		}

		addRecipe(item) {
			var dummyStatedata = this.state.data;
			dummyStatedata.push(item);
			this.setState({data: dummyStatedata})
		}
		render() {
			return (
				<Grid>
				<Row className="show-grid">
					<Col xs={12} md={10} mdOffset={1} >
						<h1>FreeCodeCamp Recipe Box Project</h1>
						<RecipeList recipedata={this.state.data} onRemove={this.deleteRecipe}/>
						<AddRecipe onAdd={this.addRecipe} />
						<AddRecipeModal />
					</Col>
				</Row>
				</Grid>
			)
		}
	}

	class RecipeList extends React.Component {
		remove(recipe){
			return function(e) {
				e.preventDefault();
				return this.props.onRemove(recipe);
			}.bind(this);
		}
		render() {
			var recipeData = this.props.recipedata.map(function(recipe,i) {
				return (
					<PanelGroup accordion>
							<Panel collapsible header={recipe.name}>
							<RecipeIngredients ingredients={recipe.ingredients.split(', ')} />
							<Button bsStyle="danger" data-id={recipe.id} onClick={this.remove(recipe)}>Remove</Button>
							</Panel>
					</PanelGroup>
				)}.bind(this));
			return (
				<div>
					<h2>Recipes</h2>
					{recipeData}
				</div>
			)
		}
	}

	class RecipeIngredients extends React.Component{
	render() {
		var ingredients = this.props.ingredients.map(function(ingredient) {
			return(
				<ListGroupItem>{ingredient}</ListGroupItem>
			)
		})
		return (
			<ListGroup>
				{ingredients}
			</ListGroup>
		)
	}
	}

	class AddRecipe extends React.Component{
		addRecipeComponentButton() {
			return function(e) {
				e.preventDefault();
				var recipe = {name: document.getElementById("recipeInput").value, ingredients: document.getElementById("recipeIngredients").value}
				return this.props.onAdd(recipe);
			}.bind(this);
		}
		render() {
			return(
				<div>
					<p><strong>Recipe Name</strong> <br />
					<input type="text" id="recipeInput" /></p>
					<p><strong>Ingredients</strong> <br />
					<input type="text" id="recipeIngredients" /></p>
					<button type="button" className="button primary" onClick={this.addRecipeComponentButton()}>Add Recipe</button>
				</div>
			)
	}}

	var AddRecipeModal = React.createClass({
		getInitialState() {
			return { showModal: false };
		},
		close() {
			this.setState({ showModal:false });
		},
		open() {
			this.setState({ showModal: true });
		},
		addRecipeComponentButton() {
			return function(e) {
				e.preventDefault();
				var recipe = {name: document.getElementById("recipeInput").value, ingredients: document.getElementById("recipeIngredients").value}
				return this.props.onAdd(recipe);
			}.bind(this);
		},

		render() {
			return(
				<div>
					<Button bsStyle="primary" onClick={this.open}>Add Recipe</Button>
					<Modal show={this.state.showModal} onHide={this.close}>
						<Modal.Header closeButton>
							<Modal.Title>Add a recipe!</Modal.Title>
						</Modal.Header>
						<Modal.Body>
							<p><strong>Recipe Name</strong> <br />
							<input type="text" id="recipeInput" /></p>
							<p><strong>Ingredients</strong> <br />
							<input type="text" id="recipeIngredients" /></p>
						</Modal.Body>
						<Modal.Footer>
							<Button onClick={this.addRecipeComponentButton()}>Add Recipe To List</Button>
							<Button onClick={this.close}>Close</Button>
						</Modal.Footer>
					</Modal>
				</div>
				)
		}
	})

	ReactDOM.render(
		<RecipeBox />,
		document.getElementById('root')
	)
	</script>
</body>
